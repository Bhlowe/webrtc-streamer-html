/**
 * Minified by jsDelivr using UglifyJS v3.0.24.
 * Original file: /npm/strophejs-plugin-caps@1.1.0/lib/strophe.caps.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("strophe.js"),require("strophejs-plugin-disco")):"function"==typeof define&&define.amd?define(["strophe.js","strophejs-plugin-disco"],t):t(e.window)}(this,function(e){"use strict";e.Strophe.addConnectionPlugin("caps",{HASH:"sha-1",node:"http://strophe.im/strophejs/",_ver:"",_connection:null,_knownCapabilities:{},_jidVerIndex:{},init:function(t){if(this._connection=t,e.Strophe.addNamespace("CAPS","http://jabber.org/protocol/caps"),!this._connection.disco)throw"Caps plugin requires the disco plugin to be installed.";this._connection.disco.addFeature(e.Strophe.NS.CAPS),this._connection.addHandler(this._delegateCapabilities.bind(this),e.Strophe.NS.CAPS)},generateCapsAttrs:function(){return{xmlns:e.Strophe.NS.CAPS,hash:this.HASH,node:this.node,ver:this.generateVer()}},generateVer:function(){if(""!==this._ver)return this._ver;for(var e="",t=this._connection.disco._identities.sort(this._sortIdentities),i=t.length,n=this._connection.disco._features.sort(),r=n.length,s=0;s<i;s++){var o=t[s];e+=o.category+"/"+o.type+"/"+o.lang+"/"+o.name+"<"}for(s=0;s<r;s++)e+=n[s]+"<";return this._ver=b64_sha1(e),this._ver},getCapabilitiesByJid:function(e){return this._jidVerIndex[e]?this._knownCapabilities[this._jidVerIndex[e]]:null},_delegateCapabilities:function(e){var t=e.getAttribute("from"),i=e.querySelector("c"),n=i.getAttribute("ver"),r=i.getAttribute("node");return this._knownCapabilities[n]?(this._jidVerIndex[t]=n,this._jidVerIndex[t]&&!this._jidVerIndex[t]===n||(this._jidVerIndex[t]=n),!0):this._requestCapabilities(t,r,n)},_requestCapabilities:function(t,i,n){if(t!==this._connection.jid){var r=this._connection.disco.info(t,i+"#"+n);this._connection.addHandler(this._handleDiscoInfoReply.bind(this),e.Strophe.NS.DISCO_INFO,"iq","result",r,t)}return!0},_handleDiscoInfoReply:function(e){var t=e.querySelector("query"),i=(a=t.getAttribute("node").split("#"))[1],n=e.getAttribute("from");if(this._knownCapabilities[i])this._jidVerIndex[n]&&!this._jidVerIndex[n]===i||(this._jidVerIndex[n]=i);else{var r=t.childNodes,s=r.length;this._knownCapabilities[i]=[];for(var o=0;o<s;o++){var a=r[o];this._knownCapabilities[i].push({name:a.nodeName,attributes:a.attributes})}this._jidVerIndex[n]=i}return!1},_sortIdentities:function(e,t){return e.category>t.category?1:e.category<t.category?-1:e.type>t.type?1:e.type<t.type?-1:e.lang>t.lang?1:e.lang<t.lang?-1:0}})});
//# sourceMappingURL=/sm/d7e63cc3a55864e7f7f109d0b64b664ba3ee87c37a90521fd9decf5167efc844.map
<html>
<head>
<title>WebRTC Streamer</title>
<script src="ajax.js" ></script>
<script src="webrtcstreamer.js" ></script>
<script>	
	// ------------------------------------------
	// init device list and callback
	// ------------------------------------------	
	function onGetDeviceList(request) {
		var deviceList = [];
                var argurl = location.search.slice(1);
                if (argurl) {
			deviceList.push( [argurl] );
		}
		var remoteDeviceList = JSON.parse(request.responseText);
		if (remoteDeviceList) {
			deviceList.push.apply( deviceList, remoteDeviceList );
		}

		var urllist = document.getElementById("urlList");
		var maxLength = 0;
		for (var dev in deviceList) {
			var option = document.createElement("option");
			option.text = deviceList[dev];
			maxLength = Math.max(maxLength, option.text.length);
			urllist.add(option);
		}
		var url = document.getElementById("url");
		if (urllist.length > 0) {
			url.value=urllist[0].value;
			url.size = maxLength;
		} else {
			url.value="";
		}
	}
	
	var webRtcServer = new WebRtcStreamer("remote-video");
	window.onload = function() { send("/getDeviceList", null, null, onGetDeviceList); } 
	window.onbeforeunload = function() { webRtcServer.disconnect() };
	
</script>
</head>
<body>
	<select id="urlList" onchange="this.nextElementSibling.value=this.value"></select>
	<input type="text" id="url"/>
	<button id="connect"    onclick="webRtcServer.connect(window.url.value);"    >Connect</button>
	<button id="disconnect" onclick="webRtcServer.disconnect();" >Disconnect</button>
	<br>
	<video id="remote-video" width="480px" height="360px"></video>
</body>
</html>

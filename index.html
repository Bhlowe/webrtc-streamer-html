<html>
<head>
<title>WebRTC Streamer</title>
<style media="screen" type="text/css">
 .select-editable {
     position:relative;
     border:solid grey 1px;
     width:100%;
     height:20px;
 }
 .select-editable select {
     position:absolute;
     border:none;
     font-size:14px;
     top:0px;
     left:0px;
     width:100%;
 }
 .select-editable input {
     position:absolute;
     border:none;
     font-size:14px;
     top:0px;
     left:0px;
     width:calc(100% - 14px);
 }
</style> 
<script src="ajax.js" ></script>
<script src="webrtcstreamer.js" ></script>
<script>	
	var webRtcServer = new WebRtcStreamer("remote-video");
	
	// ------------------------------------------
	// init device list and callback
	// ------------------------------------------	
	function onGetDeviceList(request) {
		var deviceList = [];
                var argurl = location.search.slice(1);
                if (argurl) {
			deviceList.push( [argurl] );
		}
		var remoteDeviceList = JSON.parse(request.responseText);
		if (remoteDeviceList) {
			deviceList.push.apply( deviceList, remoteDeviceList );
		}

		var urllist = document.getElementById("urlList");
		for (var dev in deviceList) {
			var option = document.createElement("option");
			option.text = deviceList[dev];
			urllist.add(option);
		}
		var url = document.getElementById("url");
		if (urllist.length > 0) {
			url.value=urllist[0].value;
			webRtcServer.connect(url.value);
		} else {
			url.value="";
		}
	}
	
	window.onload = function() { send("/getDeviceList", null, null, onGetDeviceList); } 
	window.onbeforeunload = function() { webRtcServer.disconnect() };
	
</script>
</head>
<body>
	<div class="select-editable">
		<select id="urlList" onchange="this.nextElementSibling.value=this.value; webRtcServer.connect(this.value);"></select>
		<input type="text" id="url" onkeypress="if (event.keyCode == 13) webRtcServer.connect(this.value)"/>
	</div>
	<br>
	<video style="display:block; margin: 0 auto;" id="remote-video" ></video>
</body>
</html>
